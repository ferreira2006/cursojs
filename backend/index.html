<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist v4.2 - JavaScript Avan√ßado</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', Arial, sans-serif; margin:10px; transition: background 0.3s, color 0.3s; background:#f0f2f5; }
  .dark-mode { background:#1e1e1e; color:#f4f4f9; }
  h2 { margin-top:0; cursor:pointer; font-size:1.2em; }
  .semana { background:#f9f9f9; border:1px solid #ddd; border-radius:10px; padding:15px; margin-bottom:20px; transition: background 0.3s; max-width:800px; margin-left:auto; margin-right:auto; box-shadow:0 2px 8px rgba(0,0,0,0.05);}
  .semana.modo-revisao { background:#fff3cd !important; }
  .nota { width:100%; min-height:50px; margin-top:10px; padding:8px; border-radius:5px; border:1px solid #ccc; }
  .top-bar { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
  .progress { margin:20px 0; height:20px; background:#ddd; border-radius:10px; overflow:hidden; max-width:800px; margin-left:auto; margin-right:auto; }
  .progress-bar { height:100%; width:0; background:#4caf50; text-align:center; color:white; line-height:20px; transition: width 0.3s; }
  .semana-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; }
  .semana-buttons { display:flex; gap:5px; flex-wrap:wrap; }
  .semana-progress { font-size:0.9em; margin-top:5px; color:#666; }
  .dark-mode .semana-progress { color:#ccc; }
  .semana-progress-bar { width:100%; height:10px; background:#ddd; border-radius:5px; overflow:hidden; margin-top:5px; }
  .semana-progress-fill { height:100%; width:0; background:#4caf50; transition: width 0.3s; }
  .hidden { display:none; }
  button { cursor:pointer; border:none; border-radius:5px; padding:5px 10px; background-color:#4caf50; color:white; transition: background 0.2s; font-size:0.9em; }
  button:hover { background-color:#45a049; }
  input[type=text] { padding:5px; border-radius:5px; border:1px solid #ccc; flex:1; min-width:120px; }
  .importante { color:red; font-weight:bold; cursor:pointer; margin-left:5px; }
  .confete { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
  .badge { display:inline-block; padding:3px 6px; border-radius:5px; background:#FFD700; color:#000; margin:2px; font-size:0.8em; }
  .tarefa { display:flex; align-items:center; gap:8px; margin-top:5px; }
  @media (max-width:600px){ 
    .top-bar{flex-direction:column;}
    .semana-buttons{flex-direction:column; align-items:flex-start;}
  }
</style>
</head>
<body>

<div class="top-bar">
  <button onclick="toggleTheme()">üåô/‚òÄÔ∏è Tema</button>
  <button onclick="exportar()">Exportar JSON</button>
  <button onclick="exportarAvancado()">Exportar Avan√ßado</button>
  <button onclick="importar()">Importar JSON</button>
  <button onclick="limpar()">Limpar Tudo</button>
  <input type="text" id="busca" placeholder="Buscar..." onkeyup="filtrar()">
  <button onclick="gerarPDF()">Exportar PDF</button>
  <button onclick="ativarModoRevisao()">Modo Revis√£o</button>
  <button onclick="exportarParaCalendario()">Exportar Calend√°rio</button>
  <button onclick="loginGoogle()">Login Google</button>
  <button onclick="salvarNoDrive()">Salvar no Drive</button>
</div>

<div id="badges-container"></div>
<div class="progress"><div class="progress-bar" id="progressBar">0%</div></div>
<div id="conteudo"></div>
<div id="confete-container" class="confete"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
const BACKEND_URL='https://cursojs-8012.onrender.com';

// ====== PLANO 8 SEMANAS ======
const coresSemana = ['#FFCDD2','#C8E6C9','#BBDEFB','#FFF9C4','#D1C4E9','#FFE0B2','#B2DFDB','#F8BBD0'];
const plano = {
  "Semana 1 ‚Äì Fundamentos": ["O que √© JS, onde roda, configurar ambiente.", "Vari√°veis (let, const, var) e tipos de dados.", "Operadores matem√°ticos e de compara√ß√£o.", "Operadores l√≥gicos (&&, ||, !).", "Exerc√≠cios pr√°ticos."],
  "Semana 2 ‚Äì Controle de Fluxo": ["if, else if, else.", "Operador tern√°rio e switch.", "Estruturas de repeti√ß√£o: for.", "Estruturas de repeti√ß√£o: while e do...while.", "Exerc√≠cios pr√°ticos."],
  "Semana 3 ‚Äì Fun√ß√µes e Escopo": ["Declara√ß√£o de fun√ß√µes e par√¢metros.", "Retorno de fun√ß√µes.", "Arrow functions.", "Escopo (global, local, bloco).", "Fun√ß√µes an√¥nimas, setTimeout e setInterval."],
  "Semana 4 ‚Äì Arrays e Objetos": ["Criar arrays e usar .push(), .pop().", ".map(), .filter(), .reduce().", "Objetos: propriedades e acesso (. e []).", "Itera√ß√£o em objetos.", "Exerc√≠cios pr√°ticos."],
  "Semana 5 ‚Äì DOM": ["Selecionar elementos (getElementById, querySelector).", "Alterar conte√∫do (innerText, innerHTML).", "Alterar estilos (.style).", "Criar e remover elementos.", "Eventos (onclick, addEventListener)."],
  "Semana 6 ‚Äì Projeto To-Do List": ["Estrutura HTML b√°sica e input para tarefas.", "Adicionar itens √† lista com JS.", "Marcar tarefas como conclu√≠das.", "Excluir tarefas.", "Salvar no localStorage."],
  "Semana 7 ‚Äì JavaScript Moderno": ["Template literals e desestrutura√ß√£o.", "Spread/rest.", "M√≥dulos (import/export).", "fetch e Promises.", "async/await."],
  "Semana 8 ‚Äì Projeto Final": ["Planejar o projeto.", "Estruturar HTML/CSS inicial.", "Criar fun√ß√µes principais.", "Consumir API.", "Finalizar e adicionar melhorias."]
};

let data = JSON.parse(localStorage.getItem('checklistData')) || {};
let modoRevisaoAtivo=false;

// ====== UTIL ======
function salvar(){ localStorage.setItem('checklistData',JSON.stringify(data)); atualizarProgresso(); atualizarBadges(); }

function initData(){
  let idx=0;
  for(const semana in plano){
    idx++;
    if(!data[idx]) data[idx]={nota:"",tarefas:plano[semana].map(t=>({titulo:t,concluido:false})),importante:false};
  }
}

// ====== GERAR CHECKLIST ======
function criarTarefa(idxSemana,idxTarefa,t){
  const div=document.createElement('div');
  div.className='tarefa';
  const chk=document.createElement('input');
  chk.type='checkbox'; chk.checked=t.concluido;
  chk.onchange=()=>{ t.concluido=chk.checked; salvar(); checkConfete(idxSemana); };
  const label=document.createElement('span'); label.textContent=t.titulo;
  div.appendChild(chk); div.appendChild(label);
  return div;
}

function gerarSemanas(){
  const conteudoDiv=document.getElementById('conteudo');
  conteudoDiv.innerHTML='';
  let idx=0;
  for(const semanaNome in plano){
    idx++;
    const sDiv=document.createElement('div');
    sDiv.className='semana';
    sDiv.style.background=coresSemana[idx%coresSemana.length];

    // Header
    const header=document.createElement('div');
    header.className='semana-header';
    const h2=document.createElement('h2'); h2.textContent=semanaNome;
    h2.onclick=()=>tarefaContainer.classList.toggle('hidden');

    const buttonsDiv=document.createElement('div'); buttonsDiv.className='semana-buttons';
    const btnMarcar=document.createElement('button'); btnMarcar.textContent='Marcar Todos';
    btnMarcar.onclick=()=>{ data[idx].tarefas.forEach(t=>t.concluido=true); gerarSemanas(); };
    const btnReset=document.createElement('button'); btnReset.textContent='Resetar';
    btnReset.onclick=()=>{ data[idx].tarefas.forEach(t=>t.concluido=false); gerarSemanas(); };
    buttonsDiv.appendChild(btnMarcar); buttonsDiv.appendChild(btnReset);

    const star=document.createElement('span'); star.className='importante'; star.textContent='‚òÖ';
    star.onclick=()=>{ data[idx].importante=!data[idx].importante; salvar(); gerarSemanas(); };

    header.appendChild(h2); header.appendChild(buttonsDiv); header.appendChild(star);

    sDiv.appendChild(header);

    // Tarefas
    const tarefaContainer=document.createElement('div');
    data[idx].tarefas.forEach((t,ti)=>tarefaContainer.appendChild(criarTarefa(idx,ti,t)));
    sDiv.appendChild(tarefaContainer);

    // Nota
    const nota=document.createElement('textarea');
    nota.className='nota'; nota.placeholder='Anota√ß√µes...'; nota.value=data[idx].nota;
    nota.oninput=(e)=>{ data[idx].nota=e.target.value; salvar(); };
    sDiv.appendChild(nota);

    // Progresso
    const progressoDiv=document.createElement('div'); progressoDiv.className='semana-progress';
    progressoDiv.textContent='0% conclu√≠do';
    sDiv.appendChild(progressoDiv);

    const progressoBar=document.createElement('div'); progressoBar.className='semana-progress-bar';
    progressoBar.innerHTML=`<div class='semana-progress-fill' style='width:0%'></div>`;
    sDiv.appendChild(progressoBar);

    conteudoDiv.appendChild(sDiv);
  }
  atualizarProgresso();
}

// ====== PROGRESSO & BADGES ======
function atualizarProgresso(){
  let totalSemanas=Object.keys(data).length;
  let totalConcluidos=0;
  document.querySelectorAll('.semana').forEach((s,i)=>{
    const t=data[i+1].tarefas;
    const concluidos=t.filter(t=>t.concluido).length;
    const perc=t.length?Math.round(concluidos/t.length*100):0;
    s.querySelector('.semana-progress').textContent=perc+'% conclu√≠do';
    s.querySelector('.semana-progress-fill').style.width=perc+'%';
    totalConcluidos+=perc;
  });
  const percGlobal=Math.round(totalConcluidos/totalSemanas);
  const pb=document.getElementById('progressBar');
  pb.style.width=percGlobal+'%'; pb.textContent=percGlobal+'%';
}

function atualizarBadges(){
  const bc=document.getElementById('badges-container'); bc.innerHTML='';
  Object.keys(data).forEach(i=>{
    if(data[i].importante){
      const b=document.createElement('div'); b.className='badge'; b.textContent='Semana '+i+' ‚òÖ';
      bc.appendChild(b);
    }
  });
}

// ====== CONFETE ======
function checkConfete(idx){
  const t=data[idx].tarefas;
  if(t.every(tt=>tt.concluido)){
    confetti({ particleCount:100, spread:70, origin:{y:0.6} });
  }
}

// ====== FILTRAR ======
function filtrar(){
  const termo=document.getElementById('busca').value.toLowerCase();
  document.querySelectorAll('.semana').forEach(s=>{
    s.style.display=s.innerText.toLowerCase().includes(termo)?'block':'none';
  });
}

// ====== EXPORT / IMPORT / LIMPAR / PDF / CALEND√ÅRIO ======
function exportar(){ const blob=new Blob([JSON.stringify(data)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='checklist.json'; a.click(); }
function exportarAvancado(){ const blob=new Blob([JSON.stringify({data,exportadoEm:new Date().toISOString()})],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='checklist-avancado.json'; a.click(); }
function importar(){ const input=document.createElement('input'); input.type='file'; input.accept='.json'; input.onchange=e=>{ const file=e.target.files[0]; const reader=new FileReader(); reader.onload=()=>{ data=JSON.parse(reader.result); initData(); gerarSemanas(); salvar(); }; reader.readAsText(file); }; input.click(); }
function limpar(){ if(confirm('Deseja limpar tudo?')){ localStorage.removeItem('checklistData'); data={}; initData(); gerarSemanas(); atualizarBadges(); } }
function gerarPDF(){ html2pdf().from(document.body).save('checklist.pdf'); }
function ativarModoRevisao(){ modoRevisaoAtivo=!modoRevisaoAtivo; document.querySelectorAll('.semana').forEach(s=>s.classList.toggle('modo-revisao')); }
function exportarParaCalendario(){ let ics="BEGIN:VCALENDAR\nVERSION:2.0\nCALSCALE:GREGORIAN\n"; Object.keys(data).forEach(i=>{ const nota=data[i].nota; if(nota){ ics+=`BEGIN:VEVENT\nSUMMARY:Semana ${i}\nDESCRIPTION:${nota}\nDTSTART:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z\nEND:VEVENT\n`; } }); ics+="END:VCALENDAR"; const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([ics],{type:'text/calendar'})); a.download='checklist.ics'; a.click(); }

// ====== TEMA ======
function toggleTheme(){ document.body.classList.toggle('dark-mode'); salvar(); }

// ====== LOGIN GOOGLE / DRIVE ======
window.addEventListener('load',()=>{
  const params=new URLSearchParams(window.location.search);
  const tokenStr=params.get('token');
  if(tokenStr){ try{ const token=JSON.parse(decodeURIComponent(tokenStr)); localStorage.setItem('googleToken',JSON.stringify(token)); window.history.replaceState({},document.title,window.location.pathname); alert('Login Google conclu√≠do! Token salvo localmente.'); }catch(e){console.error(e);} }
});

function loginGoogle(){ fetch(`${BACKEND_URL}/auth-url`).then(res=>res.json()).then(d=>{ const popup=window.open(d.url,"loginGoogle","width=500,height=600"); window.addEventListener("message",function(event){ if(event.data.googleToken){ localStorage.setItem('googleToken',JSON.stringify(event.data.googleToken)); alert('Login Google conclu√≠do! Token salvo localmente.'); popup.close(); } },{once:true}); }); }

function salvarNoDrive(){ const token=JSON.parse(localStorage.getItem('googleToken')); if(!token) return alert('Voc√™ precisa fazer login no Google antes.'); fetch(`${BACKEND_URL}/save`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,filename:'checklist.json',content:data})}).then(res=>res.json()).then(resp=>{ if(resp.success) alert('Checklist salvo com sucesso no Google Drive!'); else alert('Erro ao salvar: '+(resp.error||'desconhecido')); }).catch(err=>alert('Erro ao salvar no Google Drive: '+err)); }

// ====== INIT ======
initData();
gerarSemanas();
</script>
</body>
</html>
