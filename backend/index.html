<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist de Estudo - JavaScript Avançado v5.2</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {font-family:'Roboto',sans-serif;margin:0;padding:0;background:#f4f4f9;color:#333;transition:background .3s,color .3s}
  body.dark{background:#1e1e1e;color:#f4f4f9}
  .top-bar{position:sticky;top:0;z-index:1000;background:#6200ea;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:10px 20px}
  .top-bar button,.top-bar input{margin-left:10px;padding:6px 12px;border:none;border-radius:4px;cursor:pointer}
  .container{max-width:1000px;margin:20px auto;padding:20px}
  .semana{background:#fff;margin-bottom:15px;padding:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);transition:.3s}
  body.dark .semana{background:#2c2c2c}
  .semana h3{margin-top:0}
  .tarefas{list-style:none;padding:0}
  .tarefas li{margin:8px 0;display:flex;align-items:center;justify-content:space-between}
  .tarefas li.pendente{background:yellow}
  .progress{height:10px;background:#ddd;border-radius:5px;overflow:hidden;margin:10px 0}
  .progress-bar{height:10px;background:#6200ea;width:0;transition:width .3s}
  body.dark .progress{background:#444}
  body.dark .progress-bar{background:#bb86fc}
  .stats{display:flex;justify-content:space-around;margin:15px 0}
  .badge{display:inline-block;background:#ff9800;color:#fff;padding:5px 10px;border-radius:12px;margin:5px 0}
  #confete-canvas{position:fixed;top:0;left:0;pointer-events:none;z-index:2000}
  .toast{position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px 15px;border-radius:5px;opacity:0;transition:.5s}
  .toast.show{opacity:1}
</style>
</head>
<body>
<canvas id="confete-canvas"></canvas>
<div class="top-bar">
  <div><strong>Checklist de Estudo - JavaScript Avançado v5.2</strong></div>
  <div>
    <input type="text" id="busca" placeholder="Buscar semana...">
    <button onclick="toggleDarkMode()">🌙</button>
    <button onclick="toggleRevisao()">Revisão</button>
    <button onclick="exportarDados()">Exportar</button>
    <button onclick="importarDados()">Importar</button>
    <button onclick="exportarICS()">.ics</button>
    <button onclick="exportarPDF()">PDF</button>
    <button onclick="loginGoogle()" id="loginBtn">Login Google</button>
    <button onclick="logoutGoogle()" id="logoutBtn" style="display:none">Logout</button>
    <span id="userInfo"></span>
  </div>
</div>
<div class="container">
  <div class="stats">
    <div>Total: <span id="totalProgresso">0%</span></div>
    <div id="badges"></div>
  </div>
  <div id="semanas"></div>
</div>
<div class="toast" id="toast"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<script>
const plano=[{semana:"Semana 1",tarefas:["Introdução","Configuração","Sintaxe Básica"]},
{semana:"Semana 2",tarefas:["Funções","Escopo","Closures"]},
{semana:"Semana 3",tarefas:["Arrays","Objetos","Métodos Avançados"]}];

let data={checks:{},notas:{},dark:false,revisao:false,badges:[]};
if(localStorage.getItem("checklist"))data=JSON.parse(localStorage.getItem("checklist"));

function salvar(){localStorage.setItem("checklist",JSON.stringify(data))}
function toast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),3000)}

function gerar(){
  const c=document.getElementById("semanas");c.innerHTML="";
  plano.forEach((sem,sidx)=>{
    const div=document.createElement("div");div.className="semana";
    let html=`<h3>${sem.semana}</h3><div class="progress"><div class="progress-bar" id="pb${sidx}"></div></div><ul class="tarefas">`;
    sem.tarefas.forEach((t,idx)=>{
      const id=`${sidx}-${idx}`,checked=data.checks[id]?"checked":"";
      html+=`<li class="${data.revisao&&!data.checks[id]?"pendente":""}">
        <label><input type="checkbox" onchange="toggleCheck('${id}',${sidx})" ${checked}> ${t}</label>
        <input type="text" placeholder="Nota" value="${data.notas[id]||""}" onchange="data.notas['${id}']=this.value;salvar();">
      </li>`;
    });
    html+="</ul><button onclick='marcarTodos("+sidx+")'>Marcar Todos</button> <button onclick='resetar("+sidx+")'>Resetar</button>";
    div.innerHTML=html;c.appendChild(div);
  });
  atualizarProgresso();renderBadges();
}

function toggleCheck(id,sidx){
  data.checks[id]=!data.checks[id];salvar();atualizarProgresso();gerar();
  if(verificaSemanaConcluida(sidx))confete();
}
function marcarTodos(sidx){plano[sidx].tarefas.forEach((_,i)=>data.checks[`${sidx}-${i}`]=true);salvar();gerar()}
function resetar(sidx){plano[sidx].tarefas.forEach((_,i)=>{delete data.checks[`${sidx}-${i}`];delete data.notas[`${sidx}-${i}`]});salvar();gerar()}

function atualizarProgresso(){
  let totalT=0,feitas=0;
  plano.forEach((sem,sidx)=>{
    let f=0;
    sem.tarefas.forEach((_,i)=>{totalT++;if(data.checks[`${sidx}-${i}`])f++;});
    feitas+=f;document.getElementById("pb"+sidx).style.width=(f/sem.tarefas.length*100)+"%";
  });
  const perc=Math.round(feitas/totalT*100);document.getElementById("totalProgresso").innerText=perc+"%";
  verificarBadges(perc);
}

function verificaSemanaConcluida(sidx){return plano[sidx].tarefas.every((_,i)=>data.checks[`${sidx}-${i}`])}

function toggleDarkMode(){data.dark=!data.dark;document.body.classList.toggle("dark",data.dark);salvar()}
document.body.classList.toggle("dark",data.dark);

function toggleRevisao(){data.revisao=!data.revisao;salvar();gerar()}

function exportarDados(){const blob=new Blob([JSON.stringify(data)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="checklist.json";a.click()}
function importarDados(){const i=document.createElement("input");i.type="file";i.accept="application/json";i.onchange=e=>{const f=e.target.files[0];const r=new FileReader();r.onload=ev=>{data=JSON.parse(ev.target.result);salvar();gerar()};r.readAsText(f)};i.click()}
function exportarICS(){let cal="BEGIN:VCALENDAR\nVERSION:2.0\n";plano.forEach((sem,i)=>{const start=new Date();start.setDate(start.getDate()+i);cal+=`BEGIN:VEVENT\nSUMMARY:${sem.semana}\nDTSTART:${start.toISOString().replace(/[-:]/g,"").split(".")[0]}Z\nEND:VEVENT\n`});cal+="END:VCALENDAR";const blob=new Blob([cal],{type:"text/calendar"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="checklist.ics";a.click()}
function exportarPDF(){html2pdf().from(document.body).save()}

function loginGoogle(){toast("Login Google simulado");document.getElementById("loginBtn").style.display="none";document.getElementById("logoutBtn").style.display="inline-block";document.getElementById("userInfo").innerText="Usuário Teste"}
function logoutGoogle(){toast("Logout Google simulado");document.getElementById("loginBtn").style.display="inline-block";document.getElementById("logoutBtn").style.display="none";document.getElementById("userInfo").innerText=""}

document.getElementById("busca").addEventListener("input",e=>{
  document.querySelectorAll(".semana").forEach(div=>{div.style.display=div.innerText.toLowerCase().includes(e.target.value.toLowerCase())?"block":"none"})
});

// Confete
const canvas=document.getElementById("confete-canvas"),ctx=canvas.getContext("2d");
let confeteParticles=[];
function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight}
window.addEventListener("resize",resizeCanvas);resizeCanvas();
function confete(){for(let i=0;i<150;i++){confeteParticles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height-Math.random()*20,s:Math.random()*8+2,vy:Math.random()*3+2,color:`hsl(${Math.random()*360},100%,50%)`,life:200})}animateConfete();new Audio("https://www.soundjay.com/buttons/sounds/button-4.mp3").play()}
function animateConfete(){ctx.clearRect(0,0,canvas.width,canvas.height);confeteParticles.forEach(p=>{ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,p.s,p.s);p.y+=p.vy;p.life--});confeteParticles=confeteParticles.filter(p=>p.life>0);if(confeteParticles.length>0)requestAnimationFrame(animateConfete)}

// Badges automáticos
function verificarBadges(perc){
  const conquistas=[
    {id:"primeiro",cond:()=>Object.keys(data.checks).length>0,txt:"Primeira tarefa concluída"},
    {id:"semana1",cond:()=>verificaSemanaConcluida(0),txt:"Semana 1 concluída"},
    {id:"semana2",cond:()=>verificaSemanaConcluida(1),txt:"Semana 2 concluída"},
    {id:"semana3",cond:()=>verificaSemanaConcluida(2),txt:"Semana 3 concluída"},
    {id:"curso100",cond:()=>perc===100,txt:"Curso concluído 100%"},
    {id:"notas",cond:()=>Object.keys(data.notas).length>=3,txt:"Primeiras notas registradas"}
  ];
  conquistas.forEach(b=>{
    if(b.cond()&&!data.badges.includes(b.txt)){data.badges.push(b.txt);toast("🏅 "+b.txt);salvar()}
  });
  renderBadges();
}
function renderBadges(){document.getElementById("badges").innerHTML=data.badges.map(b=>`<span class="badge">${b}</span>`).join(" ")}

gerar();
</script>
</body>
</html>
