<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist de Estudo - JavaScript Avan√ßado v4.9</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', Arial, sans-serif; margin:0; padding-top:80px; transition: background 0.3s, color 0.3s; }
.dark-mode { background:#1e1e1e; color:#f4f4f9; }
h2 { margin-top:0; cursor:pointer; }
.semana { border:1px solid #ccc; border-radius:8px; padding:10px; margin-bottom:15px; transition: background 0.3s, color 0.3s; display:flex; flex-direction:column; }
.semana.modo-revisao { background: #fff3cd !important; }
.semana-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:5px; }
.botao-semana { padding:5px 10px; border:none; border-radius:5px; background:#4caf50; color:white; cursor:pointer; min-width:100px; flex-shrink:0; transition:0.2s, transform 0.15s, box-shadow 0.15s; }
.botao-semana:hover { background:#45a049; }
.tarefas { display:flex; flex-direction:column; gap:5px; margin-top:5px; }
.tarefas div { display:flex; align-items:center; gap:10px; }
.tarefas input { width:18px; height:18px; }
.nota { width:100%; min-height:50px; margin-top:10px; padding:8px; }
.top-bar { display:flex; flex-wrap:wrap; gap:10px; align-items:center; position:fixed; top:0; width:100%; background:#f4f4f9; padding:10px; z-index:999; box-shadow:0 2px 6px rgba(0,0,0,0.2); transition:background 0.3s; }
.dark-mode .top-bar { background:#2b2b2b; }
.top-bar-group { display:flex; gap:5px; flex-wrap:wrap; align-items:center; }
.top-bar button { background-color: #4caf50; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; transition: background 0.2s, transform 0.15s, box-shadow 0.15s; }
.top-bar button:hover { background-color: #45a049; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
.top-bar button:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
.dropdown { position:relative; display:inline-block; }
.dropbtn { background:#4caf50; color:white; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; transition:0.2s; }
.dropdown-content { display:none; position:absolute; background:#f9f9f9; min-width:150px; box-shadow:0 8px 16px rgba(0,0,0,0.2); border-radius:5px; z-index:1; flex-direction:column; }
.dropdown-content button { width:100%; text-align:left; padding:8px 12px; background:none; border:none; cursor:pointer; transition:0.2s; }
.dropdown-content button:hover { background:#e0e0e0; }
.dropdown:hover .dropdown-content { display:flex; flex-direction:column; }
.busca-group input { width:200px; padding:5px; border-radius:5px; border:1px solid #ccc; }
#toast-container { position:fixed; top:20px; right:20px; z-index:10000; }
.toast { background:#333; color:white; padding:10px 15px; border-radius:5px; margin-bottom:10px; min-width:200px; box-shadow:0 2px 6px rgba(0,0,0,0.2); opacity:0; transform:translateX(100%); transition:opacity 0.3s, transform 0.3s; }
.toast.show { opacity:1; transform:translateX(0); }
.progress { margin:20px 0; height:20px; background:#ddd; border-radius:10px; overflow:hidden; }
.progress-bar { height:100%; width:0; background:#4caf50; text-align:center; color:white; line-height:20px; transition: width 0.3s; }
.semana-progress { font-size:0.9em; margin-top:5px; color:#666; }
.dark-mode .semana-progress { color:#ccc; }
.semana-progress-bar { width:100%; height:10px; background:#ddd; border-radius:5px; overflow:hidden; margin-top:5px; }
.semana-progress-fill { height:100%; width:0; background:#4caf50; transition: width 0.3s; }
.confete { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
.badge { display:inline-block; padding:3px 6px; border-radius:5px; background:#FFD700; color:#000; margin:2px; font-size:0.8em; }
@media (max-width:600px){ .top-bar{flex-direction:column;} .busca-group input{width:100%;} .botao-semana{width:100%;} }
</style>
</head>
<body>

<div class="top-bar">
  <div class="top-bar-group">
    <button onclick="toggleTheme()">üåô/‚òÄÔ∏è Tema</button>
    <button onclick="ativarModoRevisao()">üìù Modo Revis√£o</button>
    <button onclick="limpar()">üóëÔ∏è Limpar Tudo</button>
  </div>

  <div class="top-bar-group dropdown">
    <button class="dropbtn">üì§ Exportar</button>
    <div class="dropdown-content">
      <button onclick="exportar()">JSON</button>
      <button onclick="exportarAvancado()">Avan√ßado</button>
      <button onclick="gerarPDF()">PDF</button>
      <button onclick="exportarParaCalendario()">Calend√°rio</button>
    </div>
  </div>

  <div class="top-bar-group">
    <button onclick="importar()">üì• Importar JSON</button>
  </div>

  <div class="top-bar-group dropdown">
    <button class="dropbtn">üîë Google</button>
    <div class="dropdown-content">
      <button onclick="loginGoogle()">Login</button>
      <button onclick="logoutGoogle()">Logout</button>
      <button onclick="salvarNoDrive()">Salvar no Drive</button>
    </div>
    <div id="usuario-logado" style="display:flex; align-items:center; gap:5px;">
      <img id="usuario-avatar" src="" alt="" style="width:24px; height:24px; border-radius:50%; display:none;">
      <span id="usuario-email">Nenhuma conta conectada</span>
    </div>
  </div>

  <div class="top-bar-group busca-group">
    <input type="text" id="busca" placeholder="Buscar..." onkeyup="filtrar()">
  </div>
</div>

<div id="badges-container"></div>
<div class="progress"><div class="progress-bar" id="progressBar">0%</div></div>
<div id="conteudo"></div>
<canvas id="confete-canvas" class="confete"></canvas>
<div id="toast-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
// ================= Dados ======================
const coresSemana=['#FFCDD2','#C8E6C9','#BBDEFB','#FFF9C4','#D1C4E9','#FFE0B2','#B2DFDB','#F8BBD0'];
const plano={
  "Semana 1 ‚Äì Fundamentos":["O que √© JS, onde roda, configurar ambiente.","Vari√°veis e tipos de dados.","Operadores matem√°ticos e l√≥gicos.","Exerc√≠cios pr√°ticos."],
  "Semana 2 ‚Äì Controle de Fluxo":["if, else if, else.","Operador tern√°rio e switch.","Estruturas de repeti√ß√£o: for, while, do...while.","Exerc√≠cios pr√°ticos."],
  "Semana 3 ‚Äì Fun√ß√µes e Escopo":["Declara√ß√£o de fun√ß√µes.","Arrow functions.","Escopo global, local e de bloco.","setTimeout e setInterval."],
  "Semana 4 ‚Äì Arrays e Objetos":["Criar arrays e usar .push(), .pop().",".map(), .filter(), .reduce().","Objetos e itera√ß√£o.","Exerc√≠cios pr√°ticos."],
  "Semana 5 ‚Äì DOM":["Selecionar elementos e alterar conte√∫do.","Alterar estilos e criar/remover elementos.","Eventos: onclick, addEventListener.","Exerc√≠cios pr√°ticos."],
  "Semana 6 ‚Äì Projeto To-Do List":["Estrutura HTML e input para tarefas.","Adicionar itens √† lista.","Marcar como conclu√≠do.","Excluir tarefas.","Salvar no localStorage."],
  "Semana 7 ‚Äì JS Moderno":["Template literals, desestrutura√ß√£o.","Spread/rest, m√≥dulos.","fetch e Promises.","async/await."],
  "Semana 8 ‚Äì Projeto Final":["Planejar projeto.","Estruturar HTML/CSS.","Criar fun√ß√µes principais.","Consumir API.","Finalizar e melhorias extras."]
};
let data = JSON.parse(localStorage.getItem('data')) || { check: {}, notes: {}, dark:false, historico:[], pontos:0, badges:[] };
let modoRevisaoAtivo=false;
const BACKEND_URL='https://cursojs-8012.onrender.com';

// ================= Toast ======================
const showToast=(msg,duration=3000)=>{
  const container=document.getElementById('toast-container');
  const toast=document.createElement('div'); toast.className='toast'; toast.textContent=msg;
  container.appendChild(toast);
  setTimeout(()=>toast.classList.add('show'),50);
  setTimeout(()=>{ toast.classList.remove('show'); setTimeout(()=>container.removeChild(toast),300); },duration);
};

// ================= Confete ======================
const confeteCanvas=document.getElementById('confete-canvas');
confeteCanvas.width=window.innerWidth; confeteCanvas.height=window.innerHeight;
const confete={
  particles: [],
  start(){ for(let i=0;i<100;i++){ const angle=Math.random()*2*Math.PI; const speed=Math.random()*6+4; this.particles.push({ x:confeteCanvas.width/2, y:confeteCanvas.height/3, dx:Math.cos(angle)*speed, dy:Math.sin(angle)*speed, size:Math.random()*6+2, color:`hsl(${Math.random()*360},100%,50%)`, life:100 }); } this.animate(); setTimeout(()=>this.particles=[],10000); },
  animate(){ const ctx=confeteCanvas.getContext('2d'); ctx.clearRect(0,0,confeteCanvas.width,confeteCanvas.height); this.particles.forEach(p=>{ p.x+=p.dx; p.y+=p.dy; p.dy+=0.05; p.size*=0.95; p.life-=2; ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,2*Math.PI); ctx.fill(); }); this.particles=this.particles.filter(p=>p.life>0); if(this.particles.length>0) requestAnimationFrame(()=>this.animate()); }
};

// ================= Fun√ß√µes ======================
const salvarDados=()=>{ localStorage.setItem('data',JSON.stringify(data)); atualizarProgresso(); atualizarBadges(); };
const criarTarefa=(semana, idx, t, i)=>{ const chk=document.createElement('input'); chk.type='checkbox'; chk.id=`s${idx}d${i}`; chk.checked=data.check[chk.id]||false; chk.onchange=()=>{ data.check[chk.id]=chk.checked; salvarDados(); checarConfete(idx); if(modoRevisaoAtivo) ativarModoRevisao(); }; const label=document.createElement('span'); label.textContent=t; const div=document.createElement('div'); div.appendChild(chk); div.appendChild(label); return div; };
const gerarSemana=(semana,tarefas,idx)=>{ const div=document.createElement('div'); div.className='semana'; div.style.background=coresSemana[idx%coresSemana.length]; const header=document.createElement('div'); header.className='semana-header'; header.innerHTML=`<h2 onclick="toggleCollapse(${idx})">${semana}</h2><div style="display:flex;gap:5px;flex-wrap:wrap;"><button class="botao-semana" onclick="marcarSemana(${idx},true)">Marcar Todos</button><button class="botao-semana" onclick="marcarSemana(${idx},false)">Resetar</button></div>`; div.appendChild(header); const progresso=document.createElement('div'); progresso.className='semana-progress'; progresso.id=`semana-progress-${idx}`; div.appendChild(progresso); const progressBar=document.createElement('div'); progressBar.className='semana-progress-bar'; progressBar.innerHTML=`<div class='semana-progress-fill' id='semana-progress-fill-${idx}'></div>`; div.appendChild(progressBar); const tarefasDiv=document.createElement('div'); tarefasDiv.className='tarefas'; tarefasDiv.id=`tarefas-${idx}`; tarefas.forEach((t,i)=>tarefasDiv.appendChild(criarTarefa(semana,idx,t,i))); div.appendChild(tarefasDiv); return div; };
const gerar=()=>{ const container=document.getElementById('conteudo'); container.innerHTML=''; Object.entries(plano).forEach(([semana,tarefas],idx)=>container.appendChild(gerarSemana(semana,tarefas,idx))); atualizarProgresso(); if(modoRevisaoAtivo) ativarModoRevisao(); };
const marcarSemana=(idx,marcar)=>{ document.querySelectorAll(`#tarefas-${idx} input`).forEach(chk=>{ chk.checked=marcar; data.check[chk.id]=marcar; }); salvarDados(); };
const checarConfete=(idx)=>{ if([...document.querySelectorAll(`#tarefas-${idx} input`)].every(i=>i.checked)) confete.start(); };
const toggleCollapse=idx=>{ const el=document.getElementById(`tarefas-${idx}`); el.style.display=el.style.display==='none'?'flex':'flex'; };
const filtrar=()=>{ const termo=document.getElementById('busca').value.toLowerCase(); document.querySelectorAll('.semana').forEach(div=>{ div.style.display=div.innerText.toLowerCase().includes(termo)?'flex':'none'; }); };
const ativarModoRevisao=()=>{ modoRevisaoAtivo=!modoRevisaoAtivo; document.querySelectorAll('.semana').forEach(div=>{ if(modoRevisaoAtivo && [...div.querySelectorAll('input')].some(i=>!i.checked)) div.classList.add('modo-revisao'); else div.classList.remove('modo-revisao'); }); };

// ================= Export/Import ======================
const exportar=()=>{ const blob=new Blob([JSON.stringify(data)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='checklist.json'; a.click(); showToast('Exportado JSON'); };
const exportarAvancado=()=>{ const blob=new Blob([JSON.stringify({data,exportadoEm:new Date().toISOString()})],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='checklist-avancado.json'; a.click(); showToast('Exporta√ß√£o Avan√ßada'); };
const importar=()=>{ const input=document.createElement('input'); input.type='file'; input.accept='.json'; input.onchange=e=>{ const file=e.target.files[0]; const reader=new FileReader(); reader.onload=()=>{ data=JSON.parse(reader.result); gerar(); salvarDados(); showToast('Importado com sucesso'); }; reader.readAsText(file); }; input.click(); };
const limpar=()=>{ if(confirm("Deseja realmente limpar tudo?")){ data.check={}; data.notes={}; gerar(); salvarDados(); showToast('Tudo limpo'); } };
const gerarPDF=()=>{ html2pdf().from(document.body).save(); showToast('PDF gerado'); };
const exportarParaCalendario=()=>{ let ics="BEGIN:VCALENDAR\nVERSION:2.0\nCALSCALE:GREGORIAN\n"; Object.keys(plano).forEach((semana,idx)=>{ ics+=`BEGIN:VEVENT\nSUMMARY:${semana}\nDESCRIPTION:${plano[semana].join(', ')}\nDTSTART:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z\nEND:VEVENT\n`; }); ics+="END:VCALENDAR"; const blob=new Blob([ics],{type:"text/calendar"}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="checklist.ics"; a.click(); showToast('Calend√°rio exportado'); };
const toggleTheme=()=>{ data.dark=!data.dark; document.body.classList.toggle('dark-mode'); salvarDados(); };

// ================= Login Google / Salvar Drive ======================
const mostrarUsuario=async()=>{ const token=JSON.parse(localStorage.getItem('googleToken')); const emailSpan=document.getElementById('usuario-email'); const avatarImg=document.getElementById('usuario-avatar'); if(!token){ emailSpan.textContent="Nenhuma conta conectada"; avatarImg.style.display="none"; return; } try{ const resp=await fetch('https://www.googleapis.com/oauth2/v1/userinfo?alt=json',{headers:{Authorization:`Bearer ${token.access_token}`}}); if(resp.status!==200) throw new Error("Token inv√°lido"); const perfil=await resp.json(); emailSpan.textContent=perfil.email; if(perfil.picture){ avatarImg.src=perfil.picture; avatarImg.style.display="inline-block"; } else avatarImg.style.display="none"; }catch(e){ emailSpan.textContent="Erro ao obter usu√°rio"; avatarImg.style.display="none"; } };
const loginGoogle=()=>{ fetch(`${BACKEND_URL}/auth-url`).then(res=>res.json()).then(d=>{ const popup=window.open(d.url,"loginGoogle","width=500,height=600"); window.addEventListener('message',e=>{ if(e.data.googleToken){ localStorage.setItem('googleToken',JSON.stringify(e.data.googleToken)); mostrarUsuario(); showToast('Login conclu√≠do'); popup.close(); } },{once:true}); }); };
const logoutGoogle=()=>{ localStorage.removeItem('googleToken'); mostrarUsuario(); showToast('Logout realizado'); };
const salvarNoDrive=()=>{ const token=JSON.parse(localStorage.getItem('googleToken')); if(!token) return showToast('Fa√ßa login antes'); fetch(`${BACKEND_URL}/save`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,filename:'checklist.json',content:data})}).then(r=>r.json()).then(resp=>{ if(resp.success) showToast('Checklist salvo no Drive'); else showToast('Erro ao salvar'); }).catch(e=>showToast('Erro ao salvar')); };

// ================= Progresso / Badges ======================
const atualizarProgresso=()=>{ Object.keys(plano).forEach((semana,idx)=>{ const total=plano[semana].length; const checkeds=[...document.querySelectorAll(`#tarefas-${idx} input`)].filter(c=>c.checked).length; const perc=Math.round((checkeds/total)*100); document.getElementById(`semana-progress-${idx}`).textContent=perc+'% conclu√≠do'; document.getElementById(`semana-progress-fill-${idx}`).style.width=perc+'%'; }); const totalPerc=Math.round(Object.keys(plano).reduce((acc,semana,idx)=>acc+[...document.querySelectorAll(`#tarefas-${idx} input`)].filter(c=>c.checked).length/plano[semana].length*100,0)/Object.keys(plano).length); document.getElementById('progressBar').style.width=totalPerc+'%'; document.getElementById('progressBar').textContent=totalPerc+'%'; };
const badgesContainer=document.getElementById('badges-container');
const atualizarBadges=()=>{ badgesContainer.innerHTML=''; Object.keys(plano).forEach((semana,idx)=>{ if([...document.querySelectorAll(`#tarefas-${idx} input`)].every(i=>i.checked)){ const badge=document.createElement('div'); badge.className='badge'; badge.textContent=`${semana} ‚òÖ`; badgesContainer.appendChild(badge); } }); };

// ================= Load ======================
window.addEventListener('load',()=>{ gerar(); mostrarUsuario(); if(data.dark) document.body.classList.add('dark-mode'); });
</script>

</body>
</html>
