<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist de Estudo - JavaScript Avan√ßado v4.9</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', Arial, sans-serif; margin:0; padding-top:80px; transition: background 0.3s, color 0.3s; }
.dark-mode { background:#1e1e1e; color:#f4f4f9; }
h2 { margin-top:0; cursor:pointer; display:flex; align-items:center; gap:5px; }
.semana { border:1px solid #ccc; border-radius:8px; padding:10px; margin-bottom:15px; transition: background 0.3s, color 0.3s; display:flex; flex-direction:column; }
.semana.modo-revisao { background: #fff3cd !important; }
.semana-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:5px; }
.botao-semana { padding:5px 10px; border:none; border-radius:5px; background:#4caf50; color:white; cursor:pointer; min-width:100px; flex-shrink:0; transition:0.2s, transform 0.15s, box-shadow 0.15s; }
.botao-semana:hover { background:#45a049; }
.tarefas { display:flex; flex-direction:column; gap:5px; margin-top:5px; }
.tarefas div { display:flex; align-items:center; gap:10px; }
.tarefas input { width:18px; height:18px; }
.nota { width:100%; min-height:50px; margin-top:10px; padding:8px; }
.top-bar { display:flex; flex-wrap:wrap; gap:10px; align-items:center; position:fixed; top:0; width:100%; background:#f4f4f9; padding:10px; z-index:999; box-shadow:0 2px 6px rgba(0,0,0,0.2); transition:background 0.3s; }
.dark-mode .top-bar { background:#2b2b2b; }
.top-bar-group { display:flex; gap:5px; flex-wrap:wrap; align-items:center; }
.top-bar button { background-color: #4caf50; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; transition: background 0.2s, transform 0.15s, box-shadow 0.15s; }
.top-bar button:hover { background-color: #45a049; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
.top-bar button:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
.dropdown { position:relative; display:inline-block; }
.dropbtn { background:#4caf50; color:white; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; transition:0.2s; }
.dropdown-content { display:none; position:absolute; background:#f9f9f9; min-width:150px; box-shadow:0 8px 16px rgba(0,0,0,0.2); border-radius:5px; z-index:1; flex-direction:column; }
.dropdown-content button { width:100%; text-align:left; padding:8px 12px; background:none; border:none; cursor:pointer; transition:0.2s; }
.dropdown-content button:hover { background:#e0e0e0; }
.dropdown:hover .dropdown-content { display:flex; flex-direction:column; }
.busca-group input { width:200px; padding:5px; border-radius:5px; border:1px solid #ccc; }
#toast-container { position:fixed; top:20px; right:20px; z-index:10000; }
.toast { background:#333; color:white; padding:10px 15px; border-radius:5px; margin-bottom:10px; min-width:200px; box-shadow:0 2px 6px rgba(0,0,0,0.2); opacity:0; transform:translateX(100%); transition:opacity 0.3s, transform 0.3s; }
.toast.show { opacity:1; transform:translateX(0); }
.progress { margin:20px 0; height:20px; background:#ddd; border-radius:10px; overflow:hidden; }
.progress-bar { height:100%; width:0; background:#4caf50; text-align:center; color:white; line-height:20px; transition: width 0.3s; }
.semana-progress { font-size:0.9em; margin-top:5px; color:#666; }
.dark-mode .semana-progress { color:#ccc; }
.semana-progress-bar { width:100%; height:10px; background:#ddd; border-radius:5px; overflow:hidden; margin-top:5px; }
.semana-progress-fill { height:100%; width:0; background:#4caf50; transition: width 0.3s; }
.confete { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
.badge { display:inline-block; padding:3px 6px; border-radius:5px; background:#FFD700; color:#000; margin:2px; font-size:0.8em; }
.expand-icon { display: inline-block; margin-left: 5px; transition: transform 0.2s; }
.expand-icon.collapsed { transform: rotate(-90deg); }
.google-group { display:flex; align-items:center; gap:5px; flex-wrap:wrap; }
.google-group .dropbtn { flex-shrink:0; }
@media (max-width:600px){ .top-bar{flex-direction:column;} .busca-group input{width:100%;} .botao-semana{width:100%;} }
</style>
</head>
<body>

<div class="top-bar">
  <div class="top-bar-group">
    <button onclick="toggleTheme()">üåô/‚òÄÔ∏è Tema</button>
    <button onclick="ativarModoRevisao()">üìù Modo Revis√£o</button>
    <button onclick="limpar()">üóëÔ∏è Limpar Tudo</button>
  </div>

  <div class="top-bar-group dropdown">
    <button class="dropbtn">üì§ Exportar</button>
    <div class="dropdown-content">
      <button onclick="exportar()">JSON</button>
      <button onclick="exportarAvancado()">Avan√ßado</button>
      <button onclick="gerarPDF()">PDF</button>
      <button onclick="exportarParaCalendario()">Calend√°rio</button>
    </div>
  </div>

  <div class="top-bar-group">
    <button onclick="importar()">üì• Importar JSON</button>
  </div>

<div class="top-bar-group google-group">
  <div class="dropdown">
    <button class="dropbtn">üîë Google</button>
    <div class="dropdown-content">
      <button onclick="loginGoogle()">Login</button>
      <button onclick="logoutGoogle()">Logout</button>
      <button onclick="salvarNoDrive()">Salvar no Drive</button>
    </div>
  </div>
  <div id="usuario-logado" style="display:flex; align-items:center; gap:5px; margin-left:10px;">
    <img id="usuario-avatar" src="" alt="Avatar" style="width:24px; height:24px; border-radius:50%; display:none;">
    <span id="usuario-email">Nenhuma conta conectada</span>
  </div>
</div>

  <div class="top-bar-group busca-group">
    <input type="text" id="busca" placeholder="Buscar..." onkeyup="filtrar()">
  </div>
</div>

<div id="badges-container"></div>
<div class="progress"><div class="progress-bar" id="progressBar">0%</div></div>
<div id="conteudo"></div>
<canvas id="confete-canvas" class="confete"></canvas>
<div id="toast-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
// ================= Dados ======================
const coresSemana=['#FFCDD2','#C8E6C9','#BBDEFB','#FFF9C4','#D1C4E9','#FFE0B2','#B2DFDB','#F8BBD0'];
const plano={
  "Semana 1 ‚Äì Fundamentos":["O que √© JS, onde roda, configurar ambiente.","Vari√°veis e tipos de dados.","Operadores matem√°ticos e l√≥gicos.","Exerc√≠cios pr√°ticos."],
  "Semana 2 ‚Äì Controle de Fluxo":["if, else if, else.","Operador tern√°rio e switch.","Estruturas de repeti√ß√£o: for, while, do...while.","Exerc√≠cios pr√°ticos."],
  "Semana 3 ‚Äì Fun√ß√µes e Escopo":["Declara√ß√£o de fun√ß√µes.","Arrow functions.","Escopo global, local e de bloco.","setTimeout e setInterval."],
  "Semana 4 ‚Äì Arrays e Objetos":["Criar arrays e usar .push(), .pop().",".map(), .filter(), .reduce().","Objetos e itera√ß√£o.","Exerc√≠cios pr√°ticos."],
  "Semana 5 ‚Äì DOM":["Selecionar elementos e alterar conte√∫do.","Alterar estilos e criar/remover elementos.","Eventos: onclick, addEventListener.","Exerc√≠cios pr√°ticos."],
  "Semana 6 ‚Äì Projeto To-Do List":["Estrutura HTML e input para tarefas.","Adicionar itens √† lista.","Marcar como conclu√≠do.","Excluir tarefas.","Salvar no localStorage."],
  "Semana 7 ‚Äì JS Moderno":["Template literals, desestrutura√ß√£o.","Spread/rest, m√≥dulos.","fetch e Promises.","async/await."],
  "Semana 8 ‚Äì Projeto Final":["Planejar projeto.","Estruturar HTML/CSS.","Criar fun√ß√µes principais.","Consumir API.","Finalizar e melhorias extras."]
};
const BACKEND_URL='https://cursojs-8012.onrender.com';
let data = JSON.parse(localStorage.getItem('data')) || { check: {}, notes: {}, dark:false, historico:[], pontos:0, badges:[] };
let modoRevisaoAtivo=false;

// ================= Toast ======================
const showToast=(msg,duration=3000)=>{
  const container=document.getElementById('toast-container');
  const toast=document.createElement('div'); 
  toast.className='toast'; 
  toast.textContent=msg;
  container.appendChild(toast);
  setTimeout(()=>toast.classList.add('show'),50);
  setTimeout(()=>{ toast.classList.remove('show'); setTimeout(()=>container.removeChild(toast),300); },duration);
};

// ================= Confete Avan√ßado ======================
const confeteCanvas = document.getElementById('confete-canvas');
const ctx = confeteCanvas.getContext('2d');
function resizeCanvas(){ confeteCanvas.width=window.innerWidth; confeteCanvas.height=window.innerHeight; }
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const confete = {
  particles: [],
  cores: ['#FF595E','#FFCA3A','#8AC926','#1982C4','#6A4C93','#FF924C','#6FFFE9','#FF6FFF','#FFA500','#00FFFF'],
  start(count=200, origin={x:window.innerWidth/2, y:window.innerHeight/2}) {
    for(let i=0;i<count;i++){
      const angle = Math.random()*2*Math.PI;
      const speed = Math.random()*6+2;
      this.particles.push({
        x: origin.x, y: origin.y,
        dx: Math.cos(angle)*speed,
        dy: Math.sin(angle)*speed,
        size: Math.random()*6+4,
        color: this.cores[Math.floor(Math.random()*this.cores.length)],
        life: Math.random()*80+60,
        opacity:1,
        gravity: 0.05 + Math.random()*0.05,
        rotation: Math.random()*360,
        spin: Math.random()*0.2-0.1
      });
    }
    this.animate();
    setTimeout(()=>{ this.particles=[]; ctx.clearRect(0,0,confeteCanvas.width,confeteCanvas.height); },6000);
  },
  animate(){
    ctx.clearRect(0,0,confeteCanvas.width,confeteCanvas.height);
    this.particles.forEach(p=>{
      p.x+=p.dx; p.y+=p.dy; p.dy+=p.gravity; p.rotation+=p.spin; p.life--; p.opacity=Math.max(0,p.life/100);
      ctx.save();
      ctx.globalAlpha=p.opacity;
      ctx.translate(p.x,p.y); ctx.rotate(p.rotation*Math.PI/180);
      ctx.fillStyle=p.color;
      ctx.beginPath(); ctx.arc(0,0,p.size,0,2*Math.PI); ctx.fill();
      ctx.restore();
    });
    this.particles=this.particles.filter(p=>p.life>0);
    if(this.particles.length>0) requestAnimationFrame(()=>this.animate());
  }
};

// ================= Fun√ß√µes ======================
const salvarDados=()=>{ localStorage.setItem('data',JSON.stringify(data)); atualizarProgresso(); atualizarBadges(); };

const criarTarefa=(semana,idx,t,i)=>{
  const chk=document.createElement('input'); chk.type='checkbox'; chk.id=`s${idx}d${i}`;
  chk.checked=data.check[chk.id]||false;
  chk.onchange=()=>{ data.check[chk.id]=chk.checked; salvarDados(); checarConfete(idx); if(modoRevisaoAtivo) ativarModoRevisao(); };
  const label=document.createElement('span'); label.textContent=t;
  const div=document.createElement('div'); div.appendChild(chk); div.appendChild(label);
  return div;
};

const gerarSemana=(semana,tarefas,idx)=>{
   const div = document.createElement('div');
  div.className = 'semana';
  div.style.background = coresSemana[idx % coresSemana.length];

  // Header
  const header = document.createElement('div');
  header.className = 'semana-header';
  header.innerHTML = `
    <h2 onclick="toggleCollapse(${idx})">
      ${semana} <span class="expand-icon collapsed">‚ñº</span>
    </h2>
    <div style="display:flex;gap:5px;flex-wrap:wrap;">
      <button class="botao-semana" onclick="marcarSemana(${idx},true)">Marcar Todos</button>
      <button class="botao-semana" onclick="marcarSemana(${idx},false)">Resetar</button>
    </div>
  `;
  div.appendChild(header);

  // Progresso
  const progresso = document.createElement('div');
  progresso.className = 'semana-progress';
  progresso.id = `semana-progress-${idx}`;
  div.appendChild(progresso);

  const progressBar = document.createElement('div');
  progressBar.className = 'semana-progress-bar';
  progressBar.innerHTML = `<div class='semana-progress-fill' id='semana-progress-fill-${idx}'></div>`;
  div.appendChild(progressBar);

  // Tarefas
  const tarefasDiv = document.createElement('div');
  tarefasDiv.className = 'tarefas';
  tarefasDiv.id = `tarefas-${idx}`;
  tarefasDiv.style.display = 'none'; // inicia colapsada
  tarefas.forEach((t,i)=> tarefasDiv.appendChild(criarTarefa(semana,idx,t,i)));
  div.appendChild(tarefasDiv);

  // Nota
  const nota = document.createElement('textarea');
  nota.className = 'nota';
  nota.placeholder='Anota√ß√µes...';
  nota.value=data.notes[`nota-${idx}`]||'';
  nota.oninput=()=>{ data.notes[`nota-${idx}`]=nota.value; salvarDados(); };
  div.appendChild(nota);

  return div;
};

// ================= Renderizar Conte√∫do ======================
const conteudo=document.getElementById('conteudo');
Object.keys(plano).forEach((s,idx)=> conteudo.appendChild(gerarSemana(s,plano[s],idx)));
atualizarProgresso(); atualizarBadges();

function toggleCollapse(idx){
  const tarefas=document.getElementById(`tarefas-${idx}`);
  tarefas.style.display=(tarefas.style.display==='none')?'flex':'none';
  const icon=document.querySelectorAll(`.semana`)[idx].querySelector('.expand-icon');
  icon.classList.toggle('collapsed');
}

// ================= Progresso ======================
function atualizarProgresso(){
  let total=0, feitos=0;
  Object.keys(plano).forEach((s,idx)=>{
    const semanaTotal = plano[s].length;
    const semanaFeito = plano[s].filter((_,i)=>data.check[`s${idx}d${i}`]).length;
    total+=semanaTotal; feitos+=semanaFeito;
    const fill=document.getElementById(`semana-progress-fill-${idx}`);
    fill.style.width = ((semanaFeito/semanaTotal)*100)+'%';
    document.getElementById(`semana-progress-${idx}`).textContent=`${semanaFeito}/${semanaTotal} conclu√≠do`;
  });
  document.getElementById('progressBar').style.width=((feitos/total)*100)+'%';
  document.getElementById('progressBar').textContent=`${Math.round((feitos/total)*100)}%`;
}

// ================= Badges ======================
function atualizarBadges(){
  const container=document.getElementById('badges-container'); container.innerHTML='';
  data.badges.forEach(b=>{
    const span=document.createElement('span'); span.className='badge'; span.textContent=b;
    container.appendChild(span);
  });
}

// ================= Checar Confete ======================
function checarConfete(idx){
  if([...document.querySelectorAll(`#tarefas-${idx} input`)].every(i=>i.checked)){
    const tarefasDiv = document.getElementById(`tarefas-${idx}`);
    const rect = tarefasDiv.getBoundingClientRect();
    confete.start(200, {x: rect.left + rect.width/2, y: rect.top + rect.height/2});
  }
}

// ================= Marcar/Resetar ======================
function marcarSemana(idx,valor){ 
  plano[Object.keys(plano)[idx]].forEach((_,i)=>data.check[`s${idx}d${i}`]=valor);
  salvarDados(); atualizarProgresso();
  checarConfete(idx);
}

// ================= Filtro ======================
function filtrar(){
  const termo = document.getElementById('busca').value.toLowerCase();
  Object.keys(plano).forEach((s,idx)=>{
    const divSemana=document.querySelectorAll('.semana')[idx];
    const texto=plano[s].join(' ').toLowerCase();
    divSemana.style.display = texto.includes(termo)?'flex':'none';
  });
}

// ================= Tema ======================
function toggleTheme(){ 
  data.dark = !data.dark; 
  document.body.classList.toggle('dark-mode',data.dark); 
  salvarDados(); 
}
if(data.dark) document.body.classList.add('dark-mode');

// ================= Modo Revis√£o ======================
function ativarModoRevisao(){
  modoRevisaoAtivo=!modoRevisaoAtivo;
  document.querySelectorAll('.semana').forEach((s,idx)=>{
    const div = document.getElementById(`tarefas-${idx}`);
    if(modoRevisaoAtivo){ 
      s.classList.add('modo-revisao'); div.style.display='flex';
    }else{ 
      s.classList.remove('modo-revisao'); div.style.display='none';
    }
  });
}

// ================= Limpar ======================
function limpar(){ if(confirm('Deseja realmente limpar todos os dados?')){ data={check:{},notes:{},dark:data.dark,historico:[],pontos:0,badges:[]}; salvarDados(); location.reload(); }}

// ================= Google ======================
async function loginGoogle(){ 
  const res = await fetch(`${BACKEND_URL}/auth-url`);
  const dataUrl = await res.json();
  window.open(dataUrl.url,'_blank','width=500,height=600'); 
  window.addEventListener('message', async e=>{
    if(e.data.googleToken){
      data.googleToken=e.data.googleToken; salvarDados();
      const info = await fetch(`${BACKEND_URL}/userinfo`,{
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({token:data.googleToken})
      });
      const u = await info.json();
      document.getElementById('usuario-email').textContent=u.email;
      const avatar=document.getElementById('usuario-avatar');
      avatar.src=u.picture; avatar.style.display='block';
      showToast('Login Google realizado com sucesso!');
    }
  });
}

function logoutGoogle(){ delete data.googleToken; salvarDados(); document.getElementById('usuario-email').textContent='Nenhuma conta conectada'; document.getElementById('usuario-avatar').style.display='none'; showToast('Logout realizado!'); }

async function salvarNoDrive(){
  if(!data.googleToken){ showToast('Login Google necess√°rio!'); return; }
  const res = await fetch(`${BACKEND_URL}/save`,{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({token:data.googleToken,filename:'plano.json',content:data})
  });
  const r = await res.json();
  if(r.success) showToast('Salvo no Google Drive com sucesso!'); else showToast('Erro ao salvar no Drive');
}

// ================= Exportar ======================
function exportar(){ const blob=new Blob([JSON.stringify(data)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='plano.json'; a.click(); }
function exportarAvancado(){ showToast('Exporta√ß√£o avan√ßada ainda em implementa√ß√£o'); }
function gerarPDF(){ html2pdf().from(conteudo).save('plano.pdf'); }
function exportarParaCalendario(){ showToast('Exportar para calend√°rio ainda em implementa√ß√£o'); }
function importar(){ 
  const input=document.createElement('input'); input.type='file'; input.accept='application/json'; input.onchange=e=>{
    const file=e.target.files[0]; const reader=new FileReader();
    reader.onload=()=>{ data=JSON.parse(reader.result); salvarDados(); location.reload(); };
    reader.readAsText(file);
  }; input.click();
}
</script>
</body>
</html>
