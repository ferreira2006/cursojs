<button id="btnLogin">Login Google</button>
<button onclick="salvarNoDrive()">Salvar no Drive</button>

<script>
let userToken = null;

// Se veio token na query string (após OAuth)
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('token')) {
  userToken = JSON.parse(urlParams.get('token'));
  alert('Autenticado com sucesso!');
}

// Abre a tela de login Google
document.getElementById('btnLogin').onclick = async () => {
  const res = await fetch('https://cursojs-8012.onrender.com/auth-url');
  const data = await res.json();
  window.location.href = data.url; // redireciona para login Google
};

// Salvar no Drive
function salvarNoDrive() {
  if (!userToken) return alert('Faça login primeiro!');
  fetch('https://cursojs-8012.onrender.com/save', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ token: userToken, filename: 'checklist.json', content: data })
  })
  .then(r => r.json())
  .then(resp => alert(resp.success ? 'Checklist salvo no Google Drive!' : resp.error))
  .catch(err => console.error(err));
}
</script>
