<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist de Estudo - JavaScript Avan√ßado</title>
<style>
  body { font-family: Arial, sans-serif; margin:10px; transition: background 0.3s, color 0.3s; }
  .dark-mode { background:#1e1e1e; color:#f4f4f9; }
  h2 { margin-top:0; cursor:pointer; }
  .semana { border:1px solid #ccc; border-radius:8px; padding:10px; margin-bottom:15px; transition: background 0.3s; }
  .nota { width:100%; min-height:50px; margin-top:10px; padding:8px; }
  .top-bar { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
  .progress { margin:20px 0; height:20px; background:#ddd; border-radius:10px; overflow:hidden; }
  .progress-bar { height:100%; width:0; background:#4caf50; text-align:center; color:white; line-height:20px; transition: width 0.3s; }
  .semana-header { display:flex; justify-content:space-between; align-items:center; }
  .semana-progress { font-size:0.9em; margin-top:5px; color:#666; }
  .dark-mode .semana-progress { color:#ccc; }
  .semana-progress-bar { width:100%; height:10px; background:#ddd; border-radius:5px; overflow:hidden; margin-top:5px; }
  .semana-progress-fill { height:100%; width:0; background:#4caf50; transition: width 0.3s; }
  .hidden { display:none; }
  button { cursor:pointer; border:none; border-radius:5px; padding:5px 10px; background-color:#4caf50; color:white; transition: background 0.2s; }
  button:hover { background-color:#45a049; }
  input[type=text] { padding:5px; border-radius:5px; border:1px solid #ccc; }
  .importante { color:red; font-weight:bold; cursor:pointer; margin-left:5px; }
  .confete { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
  .badge { display:inline-block; padding:3px 6px; border-radius:5px; background:#FFD700; color:#000; margin:2px; font-size:0.8em; }
  .tempo { font-size:0.8em; color:#555; margin-left:5px; }
  #badges-container { margin-bottom:10px; }
  @media (max-width:600px){ .top-bar{flex-direction:column;} }
</style>
</head>
<body>
<div class="top-bar">
  <button onclick="toggleTheme()">üåô/‚òÄÔ∏è Tema</button>
  <button onclick="exportar()">Exportar JSON</button>
  <button onclick="exportarAvancado()">Exportar Avan√ßado</button>
  <button onclick="importar()">Importar JSON</button>
  <button onclick="limpar()">Limpar Tudo</button>
  <input type="text" id="busca" placeholder="Buscar..." onkeyup="filtrar()">
  <button onclick="gerarPDF()">Exportar PDF</button>
  <button onclick="ativarModoRevisao()">Modo Revis√£o</button>
  <button onclick="exportarParaCalendario()">Exportar Calend√°rio</button>
</div>
<div id="badges-container"></div>
<div class="progress"><div class="progress-bar" id="progressBar">0%</div></div>
<div id="conteudo"></div>
<div id="confete-container" class="confete"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script>
const coresSemana=['#FFCDD2','#C8E6C9','#BBDEFB','#FFF9C4','#D1C4E9','#FFE0B2','#B2DFDB','#F8BBD0'];
const plano={
  "Semana 1 ‚Äì Fundamentos":["O que √© JS, onde roda, configurar ambiente.","Vari√°veis (let, const, var) e tipos de dados.","Operadores matem√°ticos e de compara√ß√£o.","Operadores l√≥gicos (&&, ||, !).","Exerc√≠cios pr√°ticos (mini-calculadora, ol√° usu√°rio)."],
  "Semana 2 ‚Äì Controle de Fluxo":["if, else if, else.","Operador tern√°rio e switch.","Estruturas de repeti√ß√£o: for.","Estruturas de repeti√ß√£o: while e do...while.","Exerc√≠cios pr√°ticos (tabuada, par/√≠mpar)."],
  "Semana 3 ‚Äì Fun√ß√µes e Escopo":["Declara√ß√£o de fun√ß√µes e par√¢metros.","Retorno de fun√ß√µes.","Arrow functions.","Escopo (global, local, bloco).","Fun√ß√µes an√¥nimas, setTimeout e setInterval."],
  "Semana 4 ‚Äì Arrays e Objetos":["Criar arrays e usar .push(), .pop().", ".map(), .filter(), .reduce().", "Objetos: propriedades e acesso (. e []).", "Itera√ß√£o em objetos (for...in, Object.keys).", "Exerc√≠cios (lista de compras, objeto carro)."],
  "Semana 5 ‚Äì DOM":["Selecionar elementos (getElementById, querySelector).", "Alterar conte√∫do (innerText, innerHTML).", "Alterar estilos (.style).", "Criar e remover elementos (createElement, appendChild).", "Eventos (onclick, addEventListener)."],
  "Semana 6 ‚Äì Projeto To-Do List":["Estrutura HTML b√°sica e input para tarefas.","Adicionar itens √† lista com JS.","Marcar tarefas como conclu√≠das.","Excluir tarefas.","Melhorias: salvar no localStorage."],
  "Semana 7 ‚Äì JavaScript Moderno":["Template literals e desestrutura√ß√£o.","Spread/rest.","M√≥dulos (import e export).", "fetch e Promises.", "async/await."],
  "Semana 8 ‚Äì Projeto Final":["Planejar o projeto (ex.: clima, quiz, galeria).", "Estruturar HTML/CSS inicial.", "Criar fun√ß√µes principais.", "Consumir API (se usar).", "Finalizar e adicionar melhorias extras."]
};

let data=JSON.parse(localStorage.getItem('data'))||{check:{},notes:{},dark:false,importante:{},historico:[],pontos:0,badges:[]};
let modoRevisaoAtivo=false;

function salvar(){ localStorage.setItem('data',JSON.stringify(data)); atualizarEstatisticas(); atualizarBadges(); atualizarProgresso(); }
function carregar(){ gerar(); if(data.dark) document.body.classList.add('dark-mode'); atualizarProgresso(); atualizarBadges(); }

function atualizarEstatisticas(){
  let total=0, concluidas=0;
  Object.keys(plano).forEach((semana, idx)=>{
    let tarefas = plano[semana];
    total += tarefas.length;
    tarefas.forEach((t,i)=>{ if(data.check[`s${idx}d${i}`]) concluidas++; });
  });
  data.pontos=concluidas;
}

function atualizarBadges(){
  const container = document.getElementById('badges-container');
  container.innerHTML='';
  if(data.pontos>=10 && !data.badges.includes('10 Tarefas')) data.badges.push('10 Tarefas');
  if(data.pontos>=20 && !data.badges.includes('20 Tarefas')) data.badges.push('20 Tarefas');
  data.badges.forEach(b=>{
    let span = document.createElement('span');
    span.className='badge';
    span.textContent=b;
    container.appendChild(span);
  });
}

function atualizarProgresso(){
  const totalTarefas = Object.keys(data.check).length;
  const concluidas = Object.values(data.check).filter(v => v).length;
  const perc = totalTarefas ? Math.round((concluidas/totalTarefas)*100) : 0;
  const bar = document.getElementById('progressBar');
  bar.style.width = perc + '%';
  bar.textContent = perc + '%';
  Object.keys(plano).forEach((semana, idx) => {
    const tarefas = plano[semana];
    const conclu = tarefas.filter((t,i) => data.check[`s${idx}d${i}`]).length;
    const percSemana = tarefas.length ? Math.round((conclu/tarefas.length)*100) : 0;
    const fill = document.getElementById(`semana-progress-fill-${idx}`);
    if(fill) fill.style.width = percSemana + '%';
    const txt = document.getElementById(`semana-progress-${idx}`);
    if(txt) txt.textContent = percSemana + '% conclu√≠do';
  });
}

function checarConfete(idx){
  const semana = plano[Object.keys(plano)[idx]];
  const concluidas = semana.filter((t,i)=>data.check[`s${idx}d${i}`]).length;
  if(concluidas === semana.length){
    const confeteContainer = document.getElementById('confete-container');
    confeteContainer.innerHTML = 'üéâ'.repeat(20);
    setTimeout(()=>{ confeteContainer.innerHTML = ''; },1500);
  }
}

function adicionarHistorico(semana, tarefa, status){
  data.historico.push({semana, tarefa, status, timestamp: new Date().toISOString()});
  if(data.historico.length>100) data.historico.shift();
  salvar();
}

function toggleTheme(){ document.body.classList.toggle('dark-mode'); data.dark=document.body.classList.contains('dark-mode'); salvar(); }
function exportar(){ const json = JSON.stringify(data, null, 2); const blob = new Blob([json], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'checklist.json'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }
function exportarAvancado(){
  const jsonAvancado = {check:data.check, notes:data.notes, historico:data.historico, pontos:data.pontos, badges:data.badges};
  const blob = new Blob([JSON.stringify(jsonAvancado, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'checklist_avancado.json';
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
}
function gerarPDF(){ const conteudo = document.getElementById('conteudo'); html2pdf().from(conteudo).save('checklist.pdf'); }

function ativarModoRevisao(){
 ativarModoRevisao
}

// Expor fun√ß√µes globais para os bot√µes
window.toggleTheme = toggleTheme;
window.exportar = exportar;
window.exportarAvancado = exportarAvancado;
window.gerarPDF = gerarPDF;
window.ativarModoRevisao = ativarModoRevisao;

function marcarSemana(idx, marcar){ 
  const semanaTarefas = document.querySelectorAll(`#tarefas-${idx} input[type=checkbox]`); 
  semanaTarefas.forEach(chk => { chk.checked = marcar; data.check[chk.id] = marcar; }); 
  salvar(); 
}

function gerar(){
  const container=document.getElementById('conteudo'); container.innerHTML='';
  Object.entries(plano).forEach(([semana,tarefas],idx)=>{
    let div=document.createElement('div'); div.className='semana'; div.style.background=coresSemana[idx%coresSemana.length];
    let header=document.createElement('div'); header.className='semana-header';
    header.innerHTML=`<h2 onclick='toggleCollapse(${idx})'>${semana}</h2><div><button onclick='marcarSemana(${idx},true)'>Marcar todos</button><button onclick='marcarSemana(${idx},false)'>Resetar semana</button></div>`;
    div.appendChild(header);

    let progresso=document.createElement('div'); progresso.className='semana-progress'; progresso.id=`semana-progress-${idx}`; div.appendChild(progresso);
    let progressBar=document.createElement('div'); progressBar.className='semana-progress-bar'; progressBar.innerHTML=`<div class='semana-progress-fill' id='semana-progress-fill-${idx}'></div>`; div.appendChild(progressBar);

    let tarefasDiv=document.createElement('div'); tarefasDiv.id=`tarefas-${idx}`; tarefasDiv.className='tarefas-div';
    tarefas.forEach((t,i)=>{
      const chk=document.createElement('input'); chk.type='checkbox'; chk.id=`s${idx}d${i}`;
      chk.checked = data.check[chk.id] || false;
      chk.onchange = ()=>{ 
        data.check[chk.id]=chk.checked; 
        salvar(); 
        atualizarProgresso(); 
        checarConfete(idx); 
        adicionarHistorico(semana, t, chk.checked); 
      };
      tarefasDiv.appendChild(chk);
      const label=document.createElement('label'); label.htmlFor=chk.id; label.textContent=t;
      tarefasDiv.appendChild(label);
      tarefasDiv.appendChild(document.createElement('br'));
    });
    div.appendChild(tarefasDiv);
    container.appendChild(div);
  });
  atualizarProgresso();
}

function filtrar(){
  let termo=document.getElementById('busca').value.toLowerCase();
  document.querySelectorAll('.semana').forEach(semana=>{
    const texto=semana.innerText.toLowerCase();
    semana.style.display = texto.includes(termo) ? '' : 'none';
  });
}

// Inicializa
carregar();
</script>
</body>
</html>
